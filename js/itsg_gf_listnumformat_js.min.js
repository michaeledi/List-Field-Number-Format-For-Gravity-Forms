function itsg_gf_list_number_format_init(){var e=itsg_gf_listnumformat_js_settings.number_format_fields,i=itsg_gf_listnumformat_js_settings.form_id;for(var r in e)if(e.hasOwnProperty(r)){var t=e[r];for(var n in t)if(t.hasOwnProperty(n)){var l=r,a=n,u="string"!==t[a].isNumberFormat?t[a].isNumberFormat:"decimal_dot",o="string"==t[a].isNumberRounding||"norounding"==t[a].isNumberRounding?-1:parseInt(t[a].isNumberRounding),s="string"!==t[a].isNumberRoundingDirection?t[a].isNumberRoundingDirection:"roundclosest",_="string"!==t[a].isNumberFixedPoint&&t[a].isNumberFixedPoint,m=t[a].isNumberCalculationFormula;if(!(d=jQuery(".gfield_list_"+l+"_cell"+a+" input")).length)var d=jQuery(".gfield_list_"+l+"_cell"+a+" select");if(d.length){var f=".",g=",";"decimal_comma"==u?(f=",",g="."):"decimal_none"==u&&(f=".",g=""),d.attr("autocomplete","off"),console.log("list-field-number-format-for-gravity-forms :: field_id: "+l+" field_column: "+a+" isNumberFormat: "+u+" isNumberRounding: "+o+" isNumberFixedPoint: "+_+" isNumberRoundingDirection: "+s+" isNumberCalculationFormula: "+m),itsg_setup_total_columns(d,i,l,a,u,o,f,g,_,s),"string"!==m&&itsg_setup_row_calculations(d,i,l,a,u,o,f,g,_,s),gformInitListNumberFormatFields(d,i,l,a,u,o,f,g,_,s),itsg_setup_range(d,i,l,a,u,o,f,g,_,s),jQuery("li.gfield table.gfield_list tbody tr:not(.isNumberColumnTotalRow)").find(d).each(function(){var e=jQuery(this).val();isFinite(itsg_clean_number(e))&&jQuery(this).trigger("change")})}}}jQuery("input.isNumberColumnTotal").trigger("change")}function itsg_setup_row_calculations(field,form_id,field_id,field_column,isNumberFormat,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection){var obj=itsg_gf_listnumformat_js_settings.number_format_fields[field_id],destination_column=field_column,destination_forumla=obj[destination_column].isNumberCalculationFormula,row=field.parents("tr.gfield_list_group:not(.isNumberColumnTotalRow)"),patt=/{[^{]*?:(\d+(\.\d+)?)(:(.*?))?}/i,matches=getMatchGroups(destination_forumla,patt);for(var i in matches)if(matches.hasOwnProperty(i)){var inputId=matches[i][1],fieldId=parseInt(inputId);if(void 0!==matches[i][2]){var columnId=matches[i][2].substr(1),keyup_input=row.find(".gfield_list_"+fieldId+"_cell"+columnId+" input");if(!keyup_input.length)var keyup_input=row.find(".gfield_list_"+fieldId+"_cell"+columnId+" select")}else{var keyup_input=jQuery("#field_"+form_id+"_"+fieldId).find('input[name="input_'+inputId+'"]');if(!keyup_input.length)var keyup_input=jQuery("#field_"+form_id+"_"+fieldId).find('select[name="input_'+inputId+'"]')}keyup_input.bind("keyup",{destination_column:destination_column,matches:matches},function(event){var destination_forumla=obj[destination_column].isNumberCalculationFormula,matches=event.data.matches;jQuery(this).each(function(){var this_row=jQuery(this).parents("tr.gfield_list_group:not(.isNumberColumnTotalRow)");for(var i in matches)if(matches.hasOwnProperty(i)){var inputId=matches[i][1],fieldId=parseInt(inputId);if(void 0!==matches[i][2]){var columnId=matches[i][2].substr(1);if(this_row.length){var source_input=this_row.find(".gfield_list_"+fieldId+"_cell"+columnId+" input");if(!source_input.length)var source_input=this_row.find(".gfield_list_"+fieldId+"_cell"+columnId+" select")}else{var target_rows=jQuery("#field_"+form_id+"_"+fieldId).find("tr.gfield_list_group:not(.isNumberColumnTotalRow)"),source_input=target_rows.find(".gfield_list_"+fieldId+"_cell"+columnId+" input");if(!source_input.length)var source_input=target_rows.find(".gfield_list_"+fieldId+"_cell"+columnId+" select")}}else{var source_input=jQuery("#field_"+form_id+"_"+fieldId).find('input[name="input_'+inputId+'"]');if(!source_input.length)var source_input=jQuery("#field_"+form_id+"_"+fieldId).find('select[name="input_'+inputId+'"]')}"radio"==source_input.prop("type")&&(source_input=source_input.filter(":checked"));var value=source_input.val();value=itsg_clean_number(value,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),destination_forumla=destination_forumla.replace(matches[i][0],value);var r=new RegExp("^[0-9 -/*()]+$");if(this_row.length){if(r.test(destination_forumla)){var value=itsg_format_number_field(eval(destination_forumla),isNumberFormat,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),destination_row=jQuery(this).parents("tr.gfield_list_group:not(.isNumberColumnTotalRow)");destination_row.find(".gfield_list_"+field_id+"_cell"+field_column+" input").val(value).trigger("change"),console.log("formula: "+destination_forumla),console.log("value: "+value)}}else jQuery(".gfield_list_"+field_id+"_cell"+columnId+" input").trigger("keyup")}})})}}function itsg_setup_range(field,form_id,field_id,field_column,isNumberFormat,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection){var text_cannot_be_less_than=itsg_gf_listnumformat_js_settings.text_cannot_be_less_than,text_cannot_be_more_than=itsg_gf_listnumformat_js_settings.text_cannot_be_more_than,obj=itsg_gf_listnumformat_js_settings.number_format_fields[field_id],isNumberRangeMinFormula=void 0!==obj[field_column].isNumberRangeMinFormula?obj[field_column].isNumberRangeMinFormula:"",isNumberRangeMaxFormula=void 0!==obj[field_column].isNumberRangeMaxFormula?obj[field_column].isNumberRangeMaxFormula:"";if(isNumberRangeMinFormula.length>=1||isNumberRangeMaxFormula.length>=1){var patt=/{[^{]*?:(\d+(\.\d+)?)(:(.*?))?}/i;range_min_error=!1;var isNumberRangeMinFormula_matches=getMatchGroups(isNumberRangeMinFormula,patt);for(var i in isNumberRangeMinFormula_matches)if(isNumberRangeMinFormula_matches.hasOwnProperty(i)){var columnId=isNumberRangeMinFormula_matches[i][2].substr(1),isNumberRangeMinFormulaField=jQuery(".gfield_list_"+field_id+"_cell"+columnId+" input, .gfield_list_"+field_id+"_cell"+field_column+" input");if(!isNumberRangeMinFormulaField.length)var isNumberRangeMinFormulaField=jQuery(".gfield_list_"+field_id+"_cell"+columnId+" select, .gfield_list_"+field_id+"_cell"+field_column+" select");isNumberRangeMinFormulaField.bind("change",{field_id:field_id,field_column:field_column,isNumberRangeMinFormula:isNumberRangeMinFormula,obj:obj},function(event){range_min_error=!1;var field_id=event.data.field_id,field_column=event.data.field_column,row=jQuery(this).parents("tr.gfield_list_group"),field=row.find(".gfield_list_"+field_id+"_cell"+field_column+" input");if(!field.length)var field=row.find(".gfield_list_"+field_id+"_cell"+field_column+" select");var isNumberRangeMinFormula=event.data.isNumberRangeMinFormula,obj=event.data.obj,value=field.val(),value=itsg_clean_number(value,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),patt=/{[^{]*?:(\d+(\.\d+)?)(:(.*?))?}/i,isNumberRangeMinFormula_matches=getMatchGroups(isNumberRangeMinFormula,patt);for(var i in isNumberRangeMinFormula_matches)if(isNumberRangeMinFormula_matches.hasOwnProperty(i)){var columnId=isNumberRangeMinFormula_matches[i][2].substr(1),matched_field_column=row.find(".gfield_list_"+field_id+"_cell"+columnId+" input");if(!matched_field_column.length)var matched_field_column=row.find(".gfield_list_"+field_id+"_cell"+columnId+" select");var value=matched_field_column.val(),matched_field_column_value=itsg_clean_number(value,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),isNumberRangeMinFormula=isNumberRangeMinFormula.replace(isNumberRangeMinFormula_matches[i][0],matched_field_column_value)}var isNumberRangeMinFormula_formatted="";isNumberFormat=obj[field_column].isNumberFormat,isNumberRangeMinFormula_formatted=itsg_format_number_field(eval(isNumberRangeMinFormula),isNumberFormat,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),eval(isNumberRangeMinFormula)>value?(range_min_error=!0,field.addClass("range-error"),field.next("div.range-error").remove(),field.after("<div class='range-error'><div class='arrow-up'></div><span class='range-error-flag'>"+text_cannot_be_less_than+" "+isNumberRangeMinFormula_formatted+"</span></div>")):(field.removeClass("range-error"),field.next("div.range-error").remove())})}var isNumberRangeMaxFormula_matches=getMatchGroups(isNumberRangeMaxFormula,patt);for(var i in isNumberRangeMaxFormula_matches)if(isNumberRangeMaxFormula_matches.hasOwnProperty(i)){var columnId=isNumberRangeMaxFormula_matches[i][2].substr(1),isNumberRangeMaxFormulaField=jQuery(".gfield_list_"+field_id+"_cell"+columnId+" input, .gfield_list_"+field_id+"_cell"+field_column+" input");if(!isNumberRangeMaxFormulaField.length)var isNumberRangeMaxFormulaField=jQuery(".gfield_list_"+field_id+"_cell"+columnId+" select, .gfield_list_"+field_id+"_cell"+field_column+" select");isNumberRangeMaxFormulaField.bind("change",{field_id:field_id,field_column:field_column,isNumberRangeMaxFormula:isNumberRangeMaxFormula,obj:obj},function(event){var field_id=event.data.field_id,field_column=event.data.field_column,row=jQuery(this).parents("tr.gfield_list_group"),field=row.find(".gfield_list_"+field_id+"_cell"+field_column+" input");if(!field.length)var field=row.find(".gfield_list_"+field_id+"_cell"+field_column+" select");var isNumberRangeMaxFormula=event.data.isNumberRangeMaxFormula,obj=event.data.obj,value=field.val(),value=itsg_clean_number(value,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),patt=/{[^{]*?:(\d+(\.\d+)?)(:(.*?))?}/i,isNumberRangeMaxFormula_matches=getMatchGroups(isNumberRangeMaxFormula,patt);for(var i in isNumberRangeMaxFormula_matches)if(isNumberRangeMaxFormula_matches.hasOwnProperty(i)){var columnId=isNumberRangeMaxFormula_matches[i][2].substr(1),matched_field_column=row.find(".gfield_list_"+field_id+"_cell"+columnId+" input");if(!matched_field_column.length)var matched_field_column=row.find(".gfield_list_"+field_id+"_cell"+columnId+" select");var matched_field_value=matched_field_column.val(),matched_field_column_value=itsg_clean_number(matched_field_value,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),isNumberRangeMaxFormula=isNumberRangeMaxFormula.replace(isNumberRangeMaxFormula_matches[i][0],matched_field_column_value)}var isNumberRangeMaxFormula_formatted="";isNumberFormat=obj[field_column].isNumberFormat,isNumberRangeMaxFormula_formatted=itsg_format_number_field(eval(isNumberRangeMaxFormula),isNumberFormat,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),!range_min_error&&eval(isNumberRangeMaxFormula)<value?(field.addClass("range-error"),field.next("div.range-error").remove(),field.after("<div class='range-error'><div class='arrow-up'></div><span class='range-error-flag'>"+text_cannot_be_more_than+" "+isNumberRangeMaxFormula_formatted+"</span></div>")):range_min_error||(field.removeClass("range-error"),field.next("div.range-error").remove())})}}}function itsg_setup_total_columns(e,i,r,t,n,l,a,u,o,s){var _=itsg_gf_listnumformat_js_settings.number_format_fields[r];if("true"==("string"!==_[t].isNumberColumnTotal&&_[t].isNumberColumnTotal)){if(!jQuery("#field_"+i+"_"+r+" div.ginput_container table tbody:last-of-type tr:last-child").hasClass("isNumberColumnTotalRow")){jQuery("#field_"+i+"_"+r+" div.ginput_container table tbody tr:last-child").clone().insertAfter("#field_"+i+"_"+r+" div.ginput_container table tbody").addClass("isNumberColumnTotalRow").removeClass("gfield_list_group gfield_list_row_odd gfield_list_row_even").wrap("<tbody>");var m=jQuery("#field_"+i+"_"+r+" div.ginput_container table tbody tr.isNumberColumnTotalRow");m.find("input:not(.isNumberColumnTotal), select:not(.isNumberColumnTotal), .gfield_list_icons img").parent().empty(),m.find("td.gfield_list_cell").removeClass().addClass("gfield_list_cell"),m.find("input").prop("readonly",!0).removeAttr("tabindex").removeAttr("name"),m.find("input.isNumberColumnTotal").next("div.instruction").empty(),jQuery("#field_"+i+"_"+r+" div.ginput_container table").addClass("isNumberColumnTotalRow ")}calc_column_total(e,i,r,t,n,l,a,u,o,s)}}function itsg_gf_list_number_format_newrow(e,i){if("1"==itsg_gf_listnumformat_js_settings.is_entry_detail)var r=(t=i.parents("table.gfield_list_container").parents("td.detail-view").attr("id").split("_"))[t.length-1];else{var t;r=(t=i.parents("li.gfield").attr("id").split("_"))[t.length-1]}var n=itsg_gf_listnumformat_js_settings.form_id;e.find(".gfield_list_cell input.decimal_dot, .gfield_list_cell input.decimal_comma, .gfield_list_cell input.decimal_none, .gfield_list_cell input.currency").each(function(){var e=jQuery(this),i=e.parent("td.gfield_list_cell").index()+1,t=itsg_gf_listnumformat_js_settings.number_format_fields,l="string"!==t[r][i].isNumberFormat?t[r][i].isNumberFormat:"decimal_dot",a="string"==t[r][i].isNumberRounding||"norounding"==t[r][i].isNumberRounding?-1:parseInt(t[r][i].isNumberRounding),u="string"!==t[r][i].isNumberFixedPoint&&t[r][i].isNumberFixedPoint,o="string"!==t[r][i].isNumberRoundingDirection?t[r][i].isNumberRoundingDirection:"roundclosest",s=t[r][i].isNumberCalculationFormula,_=".",m=",";"decimal_comma"==l?(_=",",m="."):"decimal_none"==l&&(_=".",m=""),gformInitListNumberFormatFields(e,n,r,i,l,a,_,m,u,o),itsg_setup_range(e,n,r,i,l,a,_,m,u,o),"string"!==s&&itsg_setup_row_calculations(e,n,r,i,l,a,_,m,u,o),itsg_setup_total_columns(e,n,r,i,l,a,_,m,u,o)})}function gformInitListNumberFormatFields(e,i,r,t,n,l,a,u,o,s){jQuery(e).keyup(function(){jQuery(this).hasClass("isNumberColumnTotal")&&calc_column_total(e,i,r,t,n,l,a,u,o,s)}),jQuery(e).each(function(){jQuery(this).change(function(){var e=jQuery(this);if(!e.is("select")&&""!=e.val()&&"0"!=e.val()){var i=itsg_format_number_field(itsg_clean_number(i=e.val(),l,a,u,o,s),n,l,a,u,o,s);e.val(i).trigger("keyup")}})})}function calc_column_total(e,i,r,t,n,l,a,u,o,s){e=jQuery(".gfield_list_"+r+"_cell"+t+" input");var _=0;"currency"==n?(jQuery("table.gfield_list_container tbody tr:not(.isNumberColumnTotalRow)").find(e).each(function(){var e=jQuery(this).val();e=itsg_clean_number(e,l,a,u,o,s),_+=e}),_=itsg_format_number_field(_,n,l,a,u,o,s)):(jQuery("table.gfield_list_container tbody tr:not(.isNumberColumnTotalRow)").find(e).each(function(){var e=jQuery(this).val();e=itsg_clean_number(e,l,a,u,o,s),_+=parseFloat(e)}),_=itsg_format_number_field(_,n,l,a,u,o,s)),jQuery("#field_"+i+"_"+r+" div.ginput_container table tr.isNumberColumnTotalRow").find("td:nth-child("+t+") input").val(_)}function itsg_format_number_field(e,i,r,t,n,l,a){null==e&&(e=0),0==e.length&&(e=0);var u=((e=e.toString()).split(".")[1]||[]).length;return-1==r&&(r=u),l&&(u=r),"currency"==i?(value=gformFormatMoney(e),value=itsg_force_rounding(value,r,t,n,l,a)):(value=gformFormatNumber(e,u,t,n),value=itsg_force_rounding(value,r,t,n,l,a)),value}function create_length_number(e,i){return e.length<i+1?create_length_number(e+"0",i):e}function itsg_force_rounding(e,i,r,t,n,l){if(n){var a=(e.split(r)[1]||[]).length;if(a<i)for(-1==e.indexOf(r)&&(e+=r);a<i;)a=(e+="0").substr(e.indexOf(r)+1).length}return e}function toFixed(e,i){return(+(Math.round(+(e+"e"+i))+"e"+-i)).toFixed(i)}function itsg_clean_number(e,i,r,t,n,l){if(null==e)return 0;e=e.replace(/(?![.,-])[\D+]/g,"");if(","==r&&(e=e.replace(/\./g,"").replace(/\,/g,".")),e=e.replace(/\,/g,""),!gformIsNumber(e))e=0;if("rounddown"==l){var a=create_length_number("1",i);e=Math.floor(e*a)/a}else if("roundup"==l)a=create_length_number("1",i),e=Math.ceil(e*a)/a;else if("roundclosest"==l){e=parseFloat(e);-1!=i&&(e=e.toFixed(i))}return e=e.toString(),isFinite(e)||(e=0),parseFloat(e)}function itsg_gf_list_number_format_clean_row(e){e.find("div.range-error").remove(),e.find("input.range-error").removeClass("range-error")}jQuery(".gfield_list").on("click",".add_list_item,.delete_list_item",function(){itsg_gf_list_number_format_clean_row(jQuery(this).parents("tr.gfield_list_group").next("tr.gfield_list_group"))}),"1"==itsg_gf_listnumformat_js_settings.is_entry_detail?jQuery(document).ready(function(e){itsg_gf_list_number_format_init(),gform.addFilter("gform_list_item_pre_add",function(e,i){return itsg_gf_list_number_format_newrow(e,i),e});var i=gformDeleteListItem;gformDeleteListItem=function(e,r){var t=jQuery(e).parents(".gfield_list_container"),n=i.apply(this,[e,r]);return t.find("tr.gfield_list_group:first input.isNumberColumnTotal").each(function(){jQuery(this).trigger("keyup")}),n}}):jQuery(document).bind("gform_post_render",function(e){itsg_gf_list_number_format_init(),gform.addFilter("gform_list_item_pre_add",function(e,i){return itsg_gf_list_number_format_newrow(e,i),e});var i=gformDeleteListItem;gformDeleteListItem=function(e,r){var t=jQuery(e).parents(".gfield_list_container"),n=i.apply(this,[e,r]);return t.find("tr.gfield_list_group:first input.isNumberColumnTotal").each(function(){jQuery(this).trigger("keyup")}),n}});